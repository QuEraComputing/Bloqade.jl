<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>CPU Acceleration · Bloqade.jl</title><meta name="title" content="CPU Acceleration · Bloqade.jl"/><meta property="og:title" content="CPU Acceleration · Bloqade.jl"/><meta property="twitter:title" content="CPU Acceleration · Bloqade.jl"/><meta name="description" content="Documentation for Bloqade.jl."/><meta property="og:description" content="Documentation for Bloqade.jl."/><meta property="twitter:description" content="Documentation for Bloqade.jl."/><meta property="og:url" content="https://QuEraComputing.github.io/Bloqade.jl/multithreading/"/><meta property="twitter:url" content="https://QuEraComputing.github.io/Bloqade.jl/multithreading/"/><link rel="canonical" href="https://QuEraComputing.github.io/Bloqade.jl/multithreading/"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-SRKGL6MJHS"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-SRKGL6MJHS', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img class="docs-light-only" src="../assets/logo.svg" alt="Bloqade.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="Bloqade.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../julia/">The Julia Programming Language</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../lattices/">Lattices</a></li><li><a class="tocitem" href="../waveform/">Waveforms</a></li><li><a class="tocitem" href="../hamiltonians/">Hamiltonians</a></li><li><a class="tocitem" href="../registers/">Registers and Observables</a></li><li><a class="tocitem" href="../emulation/">Emulation</a></li><li><a class="tocitem" href="../subspace/">Working with Subspace</a></li><li><a class="tocitem" href="../units/">Working with Units</a></li><li><a class="tocitem" href="../mis/">Maximum Independent Set</a></li><li class="is-active"><a class="tocitem" href>CPU Acceleration</a><ul class="internal"><li><a class="tocitem" href="#Backends"><span>Backends</span></a></li><li><a class="tocitem" href="#Using-Multithreading"><span>Using Multithreading</span></a></li></ul></li><li><a class="tocitem" href="../cuda/">GPU Acceleration</a></li><li><a class="tocitem" href="../3-level/">3-Level Support and Quantum Gates</a></li><li><a class="tocitem" href="../schema/">Interacting with Neutral Atom Hardware</a></li><li><a class="tocitem" href="../capabilities/">Hardware Capabilities</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/1.blockade/main/">Rydberg Blockade</a></li><li><a class="tocitem" href="../tutorials/2.adiabatic/main/">Adiabatic Evolution</a></li><li><a class="tocitem" href="../tutorials/3.quantum-scar/main/">Quantum Scar</a></li><li><a class="tocitem" href="../tutorials/4.LGT/main/">Simulation of a Lattice Gauge Theory with Rydberg Atoms</a></li><li><a class="tocitem" href="../tutorials/5.MIS/main/">The Maximum Independent Set Problem</a></li><li><a class="tocitem" href="../tutorials/6.MWIS/main/">Maximum Weight Independent Set</a></li><li><a class="tocitem" href="../tutorials/7.QMC/main/">Quantum Monte Carlo Method</a></li><li><a class="tocitem" href="../tutorials/8.simulating noise/main/">Simulating Noise</a></li></ul></li><li><a class="tocitem" href="../contrib/">Contributing to Bloqade</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>CPU Acceleration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>CPU Acceleration</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuEraComputing/Bloqade.jl/blob/master/docs/src/multithreading.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="multithreading"><a class="docs-heading-anchor" href="#multithreading">CPU Acceleration</a><a id="multithreading-1"></a><a class="docs-heading-anchor-permalink" href="#multithreading" title="Permalink"></a></h1><p>Bloqade has multithreading-support built-in for faster simulation on multi-core CPUs.</p><h2 id="Backends"><a class="docs-heading-anchor" href="#Backends">Backends</a><a id="Backends-1"></a><a class="docs-heading-anchor-permalink" href="#Backends" title="Permalink"></a></h2><p>This is accomplished through separate Sparse-Matrix dense-Vector (SpMV) <em>backends</em> that a user can explicitly choose from to further fine-tune performance. These backends target the CSC format Sparse Matrices that are generated for simulation from Hamiltonian problems. Bloqade also uses other Sparse Matrix formats as well to maximize memory efficiency but with any backend that performs multithreading, the same parallelized functions will be used.</p><p>There are three backends to select from:</p><ul><li><code>BloqadeExpr</code> - the default that Bloqade starts with on first installation. Even if you start Julia with multiple threads, when Bloqade has this backend it <em>will not perform any multithreading</em>.</li><li><code>ThreadedSparseCSR</code> - Converts CSC matrices to CSR format and uses a simple nested for-loop to perform the SpMV multiplication. The code for this was taken from the <a href="https://github.com/BacAmorim/ThreadedSparseCSR.jl"><code>ThreadedSparseCSR</code></a> package and migrated into Bloqade to use a more up-to-date version of the <a href="https://github.com/JuliaSIMD/Polyester.jl"><code>Polyester</code></a> multithreading library, hence the name.</li><li><code>ParallelMergeCSR</code> - Takes the conjugate transpose (adjoint) of CSC matrices and uses QuEra&#39;s <a href="https://github.com/QuEraComputing/ParallelMergeCSR.jl"><code>ParallelMergeCSR</code></a> SpMV package.</li></ul><div class="admonition is-compat"><header class="admonition-header">Limited Compatibility for ParallelMergeCSR</header><div class="admonition-body"><p>ParallelMergeCSR is currently a <em>Linux-only</em> package and may be unreliable/fail to run on other operating systems. You will still be able to take advantage of multithreading through the <code>ThreadedSparseCSR</code> backend.</p></div></div><p><code>ThreadedSparseCSR</code> is ideal for smaller system sizes or if you are performing simulations with the full Hilbert space (in which case the Hamiltonian matrix has a rather even distribution of non-zero elements per row).</p><p><code>ParallelMergeCSR</code> is ideal for very large system sizes or if you are performing simulations using the Blockade <a href="../subspace/#subspace">subspace</a> where the imbalance in the number of non-zero entries per row may be larger than if a full Hilbert space simulation was performed. <code>ParallelMergeCSR</code> performs some calculations before the actual matrix-vector multiplication occurs to find the ideal distribution of work across multiple threads which means for smaller system sizes more benefit might be obtained through <code>ThreadedSparseCSR</code>.</p><h2 id="Using-Multithreading"><a class="docs-heading-anchor" href="#Using-Multithreading">Using Multithreading</a><a id="Using-Multithreading-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Multithreading" title="Permalink"></a></h2><p>To enabled multithreading you will need to first import <code>BloqadeExpr</code>.</p><pre><code class="language-julia hljs">julia&gt;using BloqadeExpr</code></pre><p>You can verify which backend you currently have enabled through:</p><pre><code class="language-julia hljs">BloqadeExpr.backend</code></pre><p>To set a new backend, pass in the name as a string using the <code>set_backend</code> function (you can pass in <code>&quot;BloqadeExpr&quot;</code>, <code>&quot;ThreadedSparseCSR&quot;</code>, or <code>&quot;ParallelMergeCSR&quot;</code>):</p><pre><code class="language-julia hljs">BloqadeExpr.set_backend(&quot;ThreadedSparseCSR&quot;)</code></pre><p>You will be prompted to restart the Julia session upon which you should also launch Julia with the desired number of threads:</p><pre><code class="nohighlight hljs">julia -t num_threads</code></pre><p>So long as the backend is not explicitly changed again through <code>BloqadeExpr.set_backend</code>, the selected backend will persist.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mis/">« Maximum Independent Set</a><a class="docs-footer-nextpage" href="../cuda/">GPU Acceleration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Saturday 14 September 2024 16:07">Saturday 14 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
